<!DOCTYPE html>
<html>
<head>
<title>Welcome to WebGL</title>
    <link rel="stylesheet" href="css/main.css" /> 
    <script src="lib/three.min.js"></script>
    <script src="lib/stats.min.js"></script>
    <script>
    
    var renderer = null, 
        scene = null, 
        camera = null,
        cube = null;

    function start()
    {
        // Grab our container div
        var container = document.getElementById("container");

        // Create the Three.js renderer, add it to our div
        renderer = new THREE.WebGLRenderer();
        renderer.setSize(container.offsetWidth, container.offsetHeight);
        container.appendChild( renderer.domElement );

        // Create a new Three.js scene
        scene = new THREE.Scene();

        // Put in a camera
        camera = new THREE.PerspectiveCamera( 45, container.offsetWidth / container.offsetHeight, 1, 4000 );
        camera.position.set( 0, 0, 4 );

        // Create a directional light to show off the object
        var light = new THREE.DirectionalLight( 0xffffff, 1.5);
        light.position.set(0, 0.3, 1);
        scene.add( light );

        // Create a shaded, texture-mapped cube and add it to the scene
        // First, create the texture map
        var mapUrl = "img/molumen_small_funny_angry_monster.jpg";
        var map = THREE.ImageUtils.loadTexture(mapUrl);
        
        // Now, create a Phong material to show shading; pass in the map
        var material = new THREE.MeshPhongMaterial({ map: map });

        // Create the cube geometry
        var geometry = new THREE.CubeGeometry(1, 1, 1);

        // And put the geometry and material together into a mesh
        cube = new THREE.Mesh(geometry, material);

        // Turn it toward the scene, or we won't see the cube shape!
        cube.rotation.x = Math.PI / 5;
        cube.rotation.y = Math.PI / 5;

        // Add the cube to our scene
        scene.add( cube );

        start_stats();
        // Run our render loop
        run();
    }

    var last_time = null;

    function run(timestamp)
    {
        // Render the scene
        renderer.render( scene, camera );

        var progress;
        if (timestamp === undefined) timestamp = 0;
        if (last_time === null) last_time = timestamp;
        progress = timestamp - last_time;
        //console.log('%s %s %s', progress, timestamp, last_time)

        cube.rotation.y -= (progress / 16.7) * 0.01
        cube.rotation.x -= (progress / 16.7) * 0.01
        cube.rotation.z -= (progress / 16.7) * 0.01
        
        last_time = timestamp;
        stats.update();
        requestAnimationFrame(run);
    }

    window.onload = function() {
      start();
    };

    function start_stats() {
        stats = new Stats();
        //stats.setMode(1); // 0: fps, 1: ms
        stats.domElement.style.position = 'absolute';
        stats.domElement.style.left = '0px';
        stats.domElement.style.top = '0px';
        document.body.appendChild( stats.domElement );
    }
    
    </script>

</head>
<body>
    <div id="container"></div>
</body>
</html>